<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Jogo da Cobra</title>
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    background: #222;
    color: white;
    margin: 0;
    padding: 0;
    overflow: hidden;
  }
  #gameCanvas {
    background: #000;
    display: block;
    margin: 10px auto;
    width: 90vw;    /* ocupa 90% da largura do ecrã */
    height: 90vw;   /* quadrado */
    max-width: 400px;
    max-height: 400px;
    touch-action: none;
  }
  #controls {
    width: 100%;
    max-width: 250px;
    margin: 15px auto;
    user-select: none;
  }
  #controls > div {
    display: flex;
    justify-content: center;
  }
  button {
    background: #444;
    border: none;
    color: white;
    font-size: 28px;
    padding: 14px;
    margin: 6px;
    border-radius: 10px;
    cursor: pointer;
    width: 70px;
    height: 70px;
  }
  button:active {
    background: #666;
  }
  #up { margin-left: 80px; }
  #left, #right { flex: 1; }
  #down { margin-left: 80px; }
</style>
</head>
<body>
  <h1>Jogo da Cobra</h1>

  <canvas id="gameCanvas" width="400" height="400"></canvas>

  <div id="controls">
    <div><button id="up">↑</button></div>
    <div>
      <button id="left">←</button>
      <button id="down">↓</button>
      <button id="right">→</button>
    </div>
  </div>

  <div id="info">
    <p>Toque nos botões ou use o teclado para jogar.</p>
  </div>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const gridSize = 20;
  const tileCount = 20; // quadrícula 20x20
  canvas.width = gridSize * tileCount;
  canvas.height = gridSize * tileCount;

  function createDefaultImage(color) {
    const c = document.createElement('canvas');
    c.width = c.height = gridSize;
    const cx = c.getContext('2d');
    cx.fillStyle = color;
    cx.fillRect(0, 0, gridSize, gridSize);
    return c;
  }

  function loadImage(url, fallbackColor) {
    return new Promise(resolve => {
      const img = new Image();
      img.onload = () => resolve(img);
      img.onerror = () => resolve(createDefaultImage(fallbackColor));
      img.src = url + (url.includes("?") ? "&" : "?") + "t=" + Date.now();
    });
  }

  const HEAD_URL = "https://raw.githubusercontent.com/Tofast78/Cobra/c144bcafbf8d6cbbc38193270c57abaaef1e0a98/assa_van.jpg";
  const FOOD_URL = "https://raw.githubusercontent.com/Tofast78/Cobra/c144bcafbf8d6cbbc38193270c57abaaef1e0a98/roller_cobra.jpg";

  let headImg, foodImg;

  ctx.fillStyle = "#888";
  ctx.font = "16px sans-serif";
  ctx.textAlign = "center";
  ctx.fillText("A carregar imagens...", canvas.width / 2, canvas.height / 2);

  Promise.all([
    loadImage(HEAD_URL, "lime"),
    loadImage(FOOD_URL, "red")
  ]).then(([hImg, fImg]) => {
    headImg = hImg;
    foodImg = fImg;
    startGame();
  });

  let snake, snakeDir, food;

  function startGame() {
    resetGame();
    setInterval(update, 150);
  }

  function resetGame() {
    snake = [{x:10, y:10}];
    snakeDir = {x:0, y:0};
    placeFood();
    draw();
  }

  function placeFood() {
    let x, y;
    do {
      x = Math.floor(Math.random() * tileCount);
      y = Math.floor(Math.random() * tileCount);
    } while (snake.some(s => s.x === x && s.y === y));
    food = {x, y};
  }

  window.addEventListener('keydown', e => {
    switch(e.key) {
      case 'ArrowUp':    if (snakeDir.y !== 1) snakeDir = {x:0, y:-1}; break;
      case 'ArrowDown':  if (snakeDir.y !== -1) snakeDir = {x:0, y:1};  break;
      case 'ArrowLeft':  if (snakeDir.x !== 1) snakeDir = {x:-1, y:0}; break;
      case 'ArrowRight': if (snakeDir.x !== -1) snakeDir = {x:1, y:0};  break;
    }
  });

  // Controlo mobile
  document.getElementById('up').addEventListener('touchstart', e => { e.preventDefault(); if (snakeDir.y !== 1) snakeDir = {x:0, y:-1}; });
  document.getElementById('down').addEventListener('touchstart', e => { e.preventDefault(); if (snakeDir.y !== -1) snakeDir = {x:0, y:1}; });
  document.getElementById('left').addEventListener('touchstart', e => { e.preventDefault(); if (snakeDir.x !== 1) snakeDir = {x:-1, y:0}; });
  document.getElementById('right').addEventListener('touchstart', e => { e.preventDefault(); if (snakeDir.x !== -1) snakeDir = {x:1, y:0}; });

  function update() {
    if (snakeDir.x === 0 && snakeDir.y === 0) { draw(); return; }

    const head = {
      x: (snake[0].x + snakeDir.x + tileCount) % tileCount,
      y: (snake[0].y + snakeDir.y + tileCount) % tileCount
    };

    if (snake.some(s => s.x === head.x && s.y === head.y)) {
      resetGame();
      return;
    }

    snake.unshift(head);

    if (head.x === food.x && head.y === food.y) {
      placeFood();
    } else {
      snake.pop();
    }

    draw();
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(foodImg, food.x * gridSize, food.y * gridSize, gridSize, gridSize);

    for (let i = 1; i < snake.length; i++) {
      const s = snake[i];
      ctx.drawImage(foodImg, s.x * gridSize, s.y * gridSize, gridSize, gridSize);
    }

    const h = snake[0];
    ctx.drawImage(headImg, h.x * gridSize, h.y * gridSize, gridSize, gridSize);
  }
})();
</script>
</body>
</html>
